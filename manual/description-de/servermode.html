<!DOCTYPE html>
<html>
<head>
    <title>Server-Modus</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <link rel="alternate" type="application/atom+xml"  title="Liste der Änderungen speedata Publisher (de)"  href="../changes-de.xml" />
    <link rel="stylesheet" href="../assets/css/normal.css" type="text/css" />
    <link rel="stylesheet" href="../assets/css/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../assets/css/colorbox.css" type="text/css" />
    <script src="../assets/js/jquery.min.js" ></script>
    <script src="../assets/js/jquery.colorbox-min.js" ></script>
    <script>
      $(document).ready(function(){
         $(".figure").colorbox({ rel: 'group1', opacity:0.5 });
      });
    </script>
</head>
<body>
<div id="logo"><a href="../index-de.html"><img src="../assets/images/publisher_logo.png" alt="Start page"></a></div>
<div class="">
<h1>Server-Modus</h1>

<p>Wird der speedata Publisher im Server-Modus gestartet (<code>sp server</code>), erwartet
das Programm HTTP-Anfragen auf Port 5266 (konfigurierbar).</p>

<p>Der Servermodus ist
ausschließlich in einer privaten Umgebung einzusetzen. Alle Anwender können
über die API-Funktionen an alle erzeugen PDF-Dateien heran kommen. Das wird
sich in einer anderen API-Version (v1 oder höher) ändern.</p>

<h2><code>/available</code></h2>

<p>Gibt den HTTP-Status 200 zurück.</p>

<h2><code>/v0/publish</code></h2>

<p>Wird die URL mit einem POST-Request aufgerufen, erwartet der speedata Publisher eine JSON-Datei im folgenden Format:</p>

<pre><code>{&lt;dateiname&gt;:&lt;base64 kodierter Inhalt&gt;,
 &lt;dateiname&gt;:&lt;base64 kodierter Inhalt&gt;,
 ...
 }
</code></pre>

<p>also z.B.</p>

<pre><code>{&quot;layout.xml&quot;:&quot;PD94bWwgdmVyc2lv....&quot;,
 &quot;data.xml&quot;:&quot;PGRhdGE+CiAgICA8Y29udGVudHM+PCFbQ0RBVEFbPHV...&quot; }
</code></pre>

<p>Diese Dateien werden in ein leeres Verzeichnis kopiert und dort wird <code>sp</code> aufgerufen. Die Rückgabe ist in der Form</p>

<pre><code>{&quot;id&quot;:&quot;752869708&quot;}
</code></pre>

<p>mit einem HTTP-Statuscode 201 (Created).</p>

<p>Falls die JSON-Datei fehlerhaft ist, wird derzeit ein HTTP-Statuscode 400 (Bad
Request) zurückgegeben, mit dem textuellen Inhalt der Fehlermeldung, z.B.:</p>

<pre><code>illegal base64 data at input byte 0
</code></pre>

<h3>Parameter</h3>

<p>Ein URL-Parameter kann angegeben werden, um die Ausgabe der PDF-Datei (ohne Dateiendung) anzugeben:</p>

<p><code>/v0/publish?jobname=meinedatei</code> setzt den Jobname auf &quot;meinedatei&quot;, so  dass <code>/v0/pdf/&lt;id&gt;</code> die PDF-Datei mit dem Dateinamen <code>meinedatei.pdf</code> zurückgibt. Das wird mithilfe des HTTP-Headers <code>Content-Disposition</code> erreicht. Wird dieser Parameter nicht angegeben, so wird der <code>jobname</code> aus der Datei <code>publisher.cfg</code> entnommen, die übermittelt wird. Ist dort keine Option <code>jobname</code> gesetzt oder wurde die Datei nicht übermittelt, dann wird der jobname 'publisher' genommen.</p>

<p>Ebenso können zusätzliche Variablen angegeben werden: <code>/v0/publish?vars=var1%3Dwert1</code>. Dies entspricht der Angabe auf der Kommandozeile. Die Übergabe erfolgt in der (URL-Kodierten) Form <code>var1=wert1,var2=wert2,var3=wert3...</code>.</p>

<h2><code>/v0/delete/&lt;id&gt;</code></h2>

<p>GET: Löscht das Verzeichnis mit dieser ID. Gibt 200 zurück, wenn die ID vorhanden ist, 404 falls nicht.</p>

<h2><code>/v0/publish/&lt;id&gt;</code></h2>

<p>Ein GET-Request mit einer Id aus dem oben beschriebenen POST-Request liefert eine JSON-Datei, mit dem Inhalt:</p>

<pre><code>{&quot;status&quot;:&quot;ok&quot;,&quot;path&quot;:&quot;/pfad/zu/publisher.pdf&quot;,&quot;blob&quot;:&quot;&lt;base64 kodiertes PDF&gt;&quot;,
  finished:&quot;2015-03-03T13:12:55+01:00&quot;}
</code></pre>

<p>oder, im Fehlerfall, falls die Id unbekannt ist:</p>

<pre><code>{&quot;status&quot;:&quot;error&quot;,&quot;path&quot;:&quot;&quot;,&quot;blob&quot;:&quot;id unknown&quot;}
</code></pre>

<p>Falls die PDF-Datei noch nicht geschrieben wurde:</p>

<pre><code>{&quot;status&quot;:&quot;error&quot;,&quot;path&quot;:&quot;&quot;,&quot;blob&quot;:&quot;in progress&quot;}
</code></pre>

<p>Das Verzeichnis mit der PDF-Datei wird nach diesem Request gelöscht, es sei denn, die URL enthält die Endung <code>?delete=false</code>.</p>

<h2><code>/v0/pdf/&lt;id&gt;</code></h2>

<p>Ein GET-Request mit der Id aus dem POST-Request von <code>/v0/publish</code>. Es wird im Erfolgsfall die PDF-Datei mit dem Statuscode 200 und dem Dateinamen <code>publisher.pdf</code> zurückgegeben. Der Request wartet auf die Fertigstellung des Publishing Prozesses. Im Fehlerfall wird nur ein Fehlercode zurück gegeben:</p>

<table>
<thead>
<tr>
<th>Statuscode</th>
<th>Beschreibung</th>
</tr>
</thead>

<tbody>
<tr>
<td>200 OK</td>
<td>PDF wurde fehlerfrei generiert</td>
</tr>

<tr>
<td>404 Not Found</td>
<td>Id ungültig</td>
</tr>

<tr>
<td>406  Not Acceptable</td>
<td>PDF wurde fehlerhaft generiert</td>
</tr>
</tbody>
</table>

<h2><code>/v0/data/&lt;id&gt;</code></h2>

<p>Liefert die Daten-Datei, die vorab auf den Server kopiert wurde. Das Format kann über den URL-Parameter <code>format</code> angegeben werden:</p>

<table>
<thead>
<tr>
<th>Format</th>
<th>Beschreibung</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>json</code> oder <code>JSON</code></td>
<td>Liefert eine JSON-Datei im Format <code>{&quot;contents&quot;:&quot;&lt;XML Text&gt;&quot;}</code></td>
</tr>

<tr>
<td><code>base64</code></td>
<td>Ergibt eine XML Datei, die base64 kodiert ist (<code>PGRhdGE+CiAgICA8....hPgo=</code>)</td>
</tr>

<tr>
<td>(keine Angabe)</td>
<td>Schreibt eine XML Datei (<code>&lt;data&gt;...&lt;/data&gt;</code>)</td>
</tr>
</tbody>
</table>

<p>Beispiel: <code>http://127.0.0.1:5266/v0/data/1347678770?format=base64</code></p>

<h2><code>/v0/layout/&lt;id&gt;</code></h2>

<p>Liefert das Layout XML, die vorab auf den Server kopiert wurde. Das Format kann über den URL-Parameter <code>format</code> angegeben werden:</p>

<table>
<thead>
<tr>
<th>Format</th>
<th>Beschreibung</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>json</code> oder <code>JSON</code></td>
<td>Liefert eine JSON-Datei im Format <code>{&quot;contents&quot;:&quot;&lt;XML Text&gt;&quot;}</code></td>
</tr>

<tr>
<td><code>base64</code></td>
<td>Ergibt eine XML Datei, die base64 kodiert ist (<code>PGRhdGE+CiAgICA8....hPgo=</code>)</td>
</tr>

<tr>
<td>(keine Angabe)</td>
<td>Schreibt eine XML Datei (<code>&lt;Layout&gt;...&lt;/Layout&gt;</code>)</td>
</tr>
</tbody>
</table>

<p>Beispiel: <code>http://127.0.0.1:5266/v0/layout/1347678770?format=base64</code></p>

<h2><code>/v0/statusfile/&lt;id&gt;</code></h2>

<p>Liefert die Datei <code>publisher.status</code>, die durch den Lauf erzeugt wurde. Das Format kann über den URL-Parameter <code>format</code> angegeben werden:</p>

<table>
<thead>
<tr>
<th>Format</th>
<th>Beschreibung</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>json</code> oder <code>JSON</code></td>
<td>Liefert eine JSON-Datei im Format <code>{&quot;contents&quot;:&quot;&lt;XML Text&gt;&quot;}</code></td>
</tr>

<tr>
<td><code>base64</code></td>
<td>Ergibt eine XML Datei, die base64 kodiert ist (<code>PGRhdGE+CiAgICA8....hPgo=</code>)</td>
</tr>

<tr>
<td>(keine Angabe)</td>
<td>Schreibt eine XML Datei (<code>&lt;Status&gt;...&lt;/Status&gt;</code>)</td>
</tr>
</tbody>
</table>

<p>Beispiel: <code>http://127.0.0.1:5266/v0/statusfile/1347678770?format=base64</code></p>

<h2><code>/v0/status</code></h2>

<p>Liefert den Status aller Publishing-Läufe zurück, die mit <code>/v0/publish</code> gestartet wurden.</p>

<p>Die zurückgegebene JSON-Datei hat folgende Schlüssel:</p>

<pre><code>{
  &quot;1997009134&quot;: {
    &quot;errorstatus&quot;: &quot;ok&quot;,
    &quot;result&quot;: &quot;finished&quot;,
    &quot;message&quot;: &quot;no errors found&quot;,
    &quot;finished&quot;: &quot;2016-05-23T11:14:14+02:00&quot;
  },
  &quot;1997329145&quot;: {
    &quot;errorstatus&quot;: &quot;ok&quot;,
    &quot;result&quot;: &quot;finished&quot;,
    &quot;message&quot;: &quot;no errors found&quot;,
    &quot;finished&quot;: &quot;2016-05-23T11:14:14+02:00&quot;
  }
}
</code></pre>

<p>Die einzelnen Felder haben dieselbe Bedeutung wie unter <code>/v0/status/&lt;id&gt;</code> beschrieben.</p>

<h2><code>/v0/status/&lt;id&gt;</code></h2>

<p>Ermittelt den Status des Publisher-Laufs, der per POST-Request an <code>/v0/publish</code> gesendet wurde.</p>

<p>Die zurückgegebene JSON Datei hat folgende Schlüssel:</p>

<table>
<thead>
<tr>
<th>Schlüssel</th>
<th>Beschreibung</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>errorstatus</code></td>
<td>Ist die Anfrage gültig? Mögliche Antworten <code>error</code> und <code>ok</code>. Wenn <code>error</code>, dann enthält der Schlüssel <code>message</code> den Grund für den Fehler, das Feld <code>result</code> ist in dem Fall ohne Bedeutung. Wenn <code>ok</code>, dann enthält das Feld <code>result</code> den Wert <code>not finished</code>, falls die PDF-Datei noch nicht erzeugt wurde.</td>
</tr>

<tr>
<td><code>result</code></td>
<td>Ist eine PDF-Datei erzeugt worden, enthält das Feld <code>result</code> <code>failed</code>, falls bei der PDF-Erzeugung Fehler aufgetreten sind, <code>not finished</code>, falls der Publishing-Prozess noch fortdauert, ansonsten <code>ok</code>.</td>
</tr>

<tr>
<td><code>message</code></td>
<td>Enthält eine informelle Nachricht zum Ergebnis. Bsp. <code>no errors found</code> oder <code>2 errors occurred during publishing run</code>.</td>
</tr>

<tr>
<td><code>finished</code></td>
<td>Enthält den Zeitstempel, zu dem das PDF fertig gestellt wurde. Format entspricht RFC3339, zum Beispiel <code>2015-12-25T12:03:04+01:00</code>.</td>
</tr>
</tbody>
</table>

<h2><code>/v0/format</code></h2>

<p>Erzeugt Trennstellen für einen Text, der per POST-Request übergeben wird. Der Text wird mit XML kodiert und kann feste Umbrüche (<code>&lt;br class=&quot;keep&quot; /&gt;</code>) oder Trennvorschläge (<code>&lt;shy class=&quot;keep&quot; /&gt;</code>) enthalten.</p>

<p>Die Rückgabe erfolgt in demselben Format wie die Anfrage.</p>

<p>Die XML-Struktur der Anfrage als auch der Rückgabe muss folgendem RelaxNG-Compact-Schema entsprechen:</p>

<pre><code>namespace a = &quot;http://relaxng.org/ns/compatibility/annotations/1.0&quot;
start =
  element root {
    element text {
      (attribute hyphenate-limit-before { xsd:unsignedInt },
       attribute hyphenate-limit-after { xsd:unsignedInt })?,
      mixed {
        element br {
          attribute class { &quot;keep&quot; | &quot;soft&quot; }?,
          empty
        }+,
        element shy {
          attribute class { &quot;keep&quot; | &quot;soft&quot; }?,
          empty
        }+
      }
    }+
  }
</code></pre>

</div>


<div style="clear:both; border-bottom: 1px solid #a0a0a0; width: 100%; margin-top: 30px;"></div>
Version: 2.9.10 | <a href="../index-de.html">Startseite</a> | <a href="../commands-de/layout.html">Elementreferenz</a> | Andere Sprache:  <a href="../description-en/servermode.html">Englisch</a>

</body>
</html>