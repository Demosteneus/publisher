<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="../css/normal.css" type="text/css" />
<link rel="stylesheet" href="../css/pygments.css" type="text/css" />
<link rel="stylesheet" href="../css/colorbox.css" type="text/css" />
<script src="../javascript/jquery.min.js" ></script>
<script src="../javascript/jquery.colorbox-min.js" ></script>
<script>
  $(document).ready(function(){
     $(".figure").colorbox({ rel: 'group1', opacity:0.5 });
  });
</script>
<title>Automatisch erstellte Verzeichnisse</title>
</head>
<body>
<div id="logo"><a href="../index-de.html"><img src="../images/publisher_logo.png" alt="Startseite"></a></div>
	<h1>Automatisch erstellte Verzeichnisse</h1>
<p>Der speedata Publisher kann beliebige Verzeichnistypen erstellen. Ob Inhaltsverzeichnis, Artikelliste oder Stichwortindex &#8211; alle Listen funktionieren nach demselben Prinzip: die notwendigen Daten (z.B. Seitenzahlen, Artikelnummern) werden in einer eigenen Datenstruktur gespeichert, auf Festplatte geschrieben und beim nächsten Lauf des Publishers werden diese Daten eingelesen und stehen sofort zur Verfügung.</p>
<p>Damit der Publisher mehrfach durchläuft, muss der Parameter <code>runs</code> auf der Kommandozeile bzw. in der Konfigurationsdatei gesetzt werden, beispielsweise mit <code>sp --runs=2</code> (Kommandozeile) bzw. <code>runs = 2</code> (Optionen).</p>
<h2>Schritt 1: Sammeln der Informationen</h2>
<p>Die beiden Befehle <a href="../commands-de/element.html">Element</a> und <a href="../commands-de/attribute.html">Attribut</a> dienen zur Strukturierung von Daten, die während der Verarbeitung gelesen werden. Mit diesen Befehlen lassen sich neue <span class="caps">XML</span> Datensatzdateien erzeugen. Die Datensatzdatei sollte eine Struktur haben, die sich für die automatische Verarbeitung mit dem Publisher eignet. Folgende Struktur könnte für eine Artikelliste sinnvoll sein:</p>
<div class="highlight"><pre><code class="xml"><span class="nt">&lt;Artikelverzeichnis&gt;</span>
  <span class="nt">&lt;Artikel</span> <span class="na">nummer=</span><span class="s">&quot;1&quot;</span> <span class="na">seite=</span><span class="s">&quot;10&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Artikel</span> <span class="na">nummer=</span><span class="s">&quot;2&quot;</span> <span class="na">seite=</span><span class="s">&quot;12&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Artikel</span> <span class="na">nummer=</span><span class="s">&quot;3&quot;</span> <span class="na">seite=</span><span class="s">&quot;14&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/Artikelverzeichnis&gt;</span>
</code></pre></div><p>Um diese Struktur im Layoutregelwerk zu erstellen, muss sie aus den Befehlen <a href="../commands-de/element.html">Element</a> und <a href="../commands-de/attribute.html">Attribut</a> wie folgt zusammengesetzt werden:</p>
<div class="highlight"><pre><code class="xml"><span class="nt">&lt;Element</span> <span class="na">name=</span><span class="s">&quot;Artikelverzeichnis&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Element</span> <span class="na">name=</span><span class="s">&quot;Artikel&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Attribut</span> <span class="na">name=</span><span class="s">&quot;nummer&quot;</span> <span class="na">auswahl=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Attribut</span> <span class="na">name=</span><span class="s">&quot;seite&quot;</span> <span class="na">auswahl=</span><span class="s">&quot;10&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/Element&gt;</span>
  <span class="nt">&lt;Element</span> <span class="na">name=</span><span class="s">&quot;Artikel&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Attribut</span> <span class="na">name=</span><span class="s">&quot;nummer&quot;</span> <span class="na">auswahl=</span><span class="s">&quot;2&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Attribut</span> <span class="na">name=</span><span class="s">&quot;seite&quot;</span> <span class="na">auswahl=</span><span class="s">&quot;12&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/Element&gt;</span>
  <span class="nt">&lt;Element</span> <span class="na">name=</span><span class="s">&quot;Artikel&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Attribut</span> <span class="na">name=</span><span class="s">&quot;nummer&quot;</span> <span class="na">auswahl=</span><span class="s">&quot;3&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Attribut</span> <span class="na">name=</span><span class="s">&quot;seite&quot;</span> <span class="na">auswahl=</span><span class="s">&quot;14&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/Element&gt;</span>
<span class="nt">&lt;/Element&gt;</span>
</code></pre></div><p>Anstelle der Befehle <a href="../commands-de/element.html">Element</a> und <a href="../commands-de/attribute.html">Attribut</a> können auch Variablen als Speicher benutzt werden (siehe Beispiel unten).</p>
<h2>Schritt 2: Speichern und Laden der Informationen</h2>
<p>Mit dem Befehl <a href="../commands-de/savedataset.html">SpeichereDatensatzdatei</a> wird die Struktur auf Festplatte gespeichert und mit <a href="../commands-de/loaddataset.html">LadeDatensatzdatei</a> wird sie wieder geladen. Existiert die Datei nicht, so wird kein Fehler gemeldet, da es sich um den ersten Durchlauf handeln könnte, wo die Datei naturgemäß noch nicht existiert.</p>
<h2>Schritt 3: Verarbeiten der Informationen</h2>
<p>Direkt nach dem Laden wird die <span class="caps">XML</span>-Verarbeitung mit dem ersten Element der gerade geladenen Struktur fortgesetzt, im Beispiel oben würde nach dem folgenden Befehl im Layoutregelwerk gesucht:</p>
<div class="highlight"><pre><code class="xml"><span class="nt">&lt;Datensatz</span> <span class="na">element=</span><span class="s">&quot;Artikelverzeichnis&quot;</span><span class="nt">&gt;</span>
  ...
<span class="nt">&lt;/Datensatz&gt;</span>
</code></pre></div><p>Das heißt, dass die eigentliche Datenverarbeitung zeitweilig unterbrochen und mit dem neuen Datensatz aus <a href="../commands-de/loaddataset.html">LadeDatensatzdatei</a> fortgeführt wird.</p>
<h2>Beispiel</h2>
<p>Das folgende Beispiel reichert die »Planetenliste« um ein Inhaltsverzeichnis an. Die Verarbeitung beginnt beim Wurzelelement <code>planeten</code> (in der Mitte der Datei). Hier wird die Datensatzdatei <code>toc</code> (für: table of contents) geladen. Im ersten Durchlauf wird die Datei nicht gefunden, daher wird die Datensatzdatei »planeten« normal weiter verarbeitet. Während des Durchlaufs wird eine Liste erstellt, die folgende <span class="caps">XML</span>-Struktur hat:</p>
<div class="highlight"><pre><code class="xml"><span class="nt">&lt;Inhaltsverzeichnis&gt;</span>
  <span class="nt">&lt;Planetenverzeichnis</span> <span class="na">name=</span><span class="s">&quot;Merkur&quot;</span> <span class="na">seite=</span><span class="s">&quot;2&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;Planetenverzeichnis</span> <span class="na">name=</span><span class="s">&quot;Venus&quot;</span> <span class="na">seite=</span><span class="s">&quot;3&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;Planetenverzeichnis</span> <span class="na">name=</span><span class="s">&quot;Erde&quot;</span> <span class="na">seite=</span><span class="s">&quot;4&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;Planetenverzeichnis</span> <span class="na">name=</span><span class="s">&quot;Mars&quot;</span> <span class="na">seite=</span><span class="s">&quot;5&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;Planetenverzeichnis</span> <span class="na">name=</span><span class="s">&quot;Jupiter&quot;</span> <span class="na">seite=</span><span class="s">&quot;6&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;Planetenverzeichnis</span> <span class="na">name=</span><span class="s">&quot;Saturn&quot;</span> <span class="na">seite=</span><span class="s">&quot;7&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;Planetenverzeichnis</span> <span class="na">name=</span><span class="s">&quot;Uranus&quot;</span> <span class="na">seite=</span><span class="s">&quot;8&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;Planetenverzeichnis</span> <span class="na">name=</span><span class="s">&quot;Neptun&quot;</span> <span class="na">seite=</span><span class="s">&quot;9&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/Inhaltsverzeichnis&gt;</span>
</code></pre></div><p>Im Layoutregelwerk muss diese den folgenden Aufbau haben:</p>
<div class="highlight"><pre><code class="xml"><span class="nt">&lt;Element</span> <span class="na">name=</span><span class="s">&quot;Inhaltsverzeichnis&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Element</span> <span class="na">name=</span><span class="s">&quot;Planetenverzeichnis&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Attribut</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span> <span class="na">auswahl=</span><span class="s">&quot;&#39;Merkur&#39;&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Attribut</span> <span class="na">name=</span><span class="s">&quot;seite&quot;</span> <span class="na">auswahl=</span><span class="s">&quot;2&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/Element&gt;</span>
  <span class="nt">&lt;Element</span> <span class="na">name=</span><span class="s">&quot;Planetenverzeichnis&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Attribut</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span> <span class="na">auswahl=</span><span class="s">&quot;&#39;Venus&#39;&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Attribut</span> <span class="na">name=</span><span class="s">&quot;seite&quot;</span> <span class="na">auswahl=</span><span class="s">&quot;3&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/Element&gt;</span>
  ...
  <span class="nt">&lt;Element</span> <span class="na">name=</span><span class="s">&quot;Planetenverzeichnis&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Attribut</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span> <span class="na">auswahl=</span><span class="s">&quot;&#39;Uranus&#39;&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Attribut</span> <span class="na">name=</span><span class="s">&quot;seite&quot;</span> <span class="na">auswahl=</span><span class="s">&quot;9&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/Element&gt;</span>
<span class="nt">&lt;/Element&gt;</span>
</code></pre></div><p>Natürlich soll die Information in den Attributen dynamisch erzeugt werden, dafür werden der XPath-Ausdruck <code>@name</code> und die XPath-Funktion <code>sd:aktuelle-seite()</code> benutzt.</p>
<p>Im zweiten Durchlauf wird die Datei erfolgreich eingelesen und die Verarbeitung »springt« zum Datensatz <code>Inhaltsverzeichnis</code>, da es das Wurzelelement der neuen Datei ist. Hier wird im Layoutregelwerk das Inhaltsverzeichnis erstellt.</p>
<div class="highlight"><pre><code class="xml"><span class="nt">&lt;Datensatz</span> <span class="na">element=</span><span class="s">&quot;Inhaltsverzeichnis&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Zuweisung</span> <span class="na">variable=</span><span class="s">&quot;Inhaltsverzeichnis&quot;</span> <span class="na">auswahl=</span><span class="s">&quot;&#39;&#39;&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;BearbeiteKnoten</span> <span class="na">auswahl=</span><span class="s">&quot;Planetenverzeichnis&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;ObjektAusgeben</span> <span class="na">spalte=</span><span class="s">&quot;3&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Textblock</span> <span class="na">breite=</span><span class="s">&quot;20&quot;</span> <span class="na">schriftart=</span><span class="s">&quot;Überschrift&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Absatz&gt;&lt;Wert&gt;</span>Inhalt<span class="nt">&lt;/Wert&gt;&lt;/Absatz&gt;</span>
    <span class="nt">&lt;/Textblock&gt;</span>
  <span class="nt">&lt;/ObjektAusgeben&gt;</span>
  <span class="nt">&lt;ObjektAusgeben</span> <span class="na">spalte=</span><span class="s">&quot;3&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Textblock</span> <span class="na">breite=</span><span class="s">&quot;20&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Wert</span> <span class="na">auswahl=</span><span class="s">&quot;$Inhaltsverzeichnis&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/Textblock&gt;</span>
  <span class="nt">&lt;/ObjektAusgeben&gt;</span>
<span class="nt">&lt;/Datensatz&gt;</span>
 
<span class="nt">&lt;Datensatz</span> <span class="na">element=</span><span class="s">&quot;Planetenverzeichnis&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Zuweisung</span> <span class="na">variable=</span><span class="s">&quot;Inhaltsverzeichnis&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Wert</span> <span class="na">auswahl=</span><span class="s">&quot;$Inhaltsverzeichnis&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Absatz&gt;</span>
      <span class="nt">&lt;Wert</span> <span class="na">auswahl=</span><span class="s">&quot;@name&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;Wert&gt;</span>, Seite <span class="nt">&lt;/Wert&gt;</span>
      <span class="nt">&lt;Wert</span> <span class="na">auswahl=</span><span class="s">&quot;@seite&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/Absatz&gt;</span>
  <span class="nt">&lt;/Zuweisung&gt;</span>
<span class="nt">&lt;/Datensatz&gt;</span>
 
<span class="c">&lt;!-- Wurzelelement --&gt;</span>
<span class="nt">&lt;Datensatz</span> <span class="na">element=</span><span class="s">&quot;planeten&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Zuweisung</span> <span class="na">variable=</span><span class="s">&quot;spalte&quot;</span> <span class="na">auswahl=</span><span class="s">&quot;2&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;LadeDatensatzdatei</span> <span class="na">name=</span><span class="s">&quot;toc&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;Zuweisung</span> <span class="na">variable=</span><span class="s">&quot;Inhalt&quot;</span> <span class="na">auswahl=</span><span class="s">&quot;&#39;&#39;&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;NeueSeite/&gt;</span>
  <span class="nt">&lt;BearbeiteKnoten</span> <span class="na">auswahl=</span><span class="s">&quot;planet&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/Datensatz&gt;</span>
 
<span class="nt">&lt;Datensatz</span> <span class="na">element=</span><span class="s">&quot;planet&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Zuweisung</span> <span class="na">variable=</span><span class="s">&quot;Inhalt&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Wert</span> <span class="na">auswahl=</span><span class="s">&quot;$Inhalt&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Element</span> <span class="na">name=</span><span class="s">&quot;Planetenverzeichnis&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Attribut</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span> <span class="na">auswahl=</span><span class="s">&quot; @name &quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;Attribut</span> <span class="na">name=</span><span class="s">&quot;seite&quot;</span> <span class="na">auswahl=</span><span class="s">&quot; sd:aktuelle-seite()&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/Element&gt;</span>
  <span class="nt">&lt;/Zuweisung&gt;</span>
 
  <span class="nt">&lt;BearbeiteKnoten</span> <span class="na">auswahl=</span><span class="s">&quot;url&quot;</span> <span class="nt">/&gt;</span>
  ...
  <span class="nt">&lt;NeueSeite</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;SpeichereDatensatzdatei</span> <span class="na">dateiname=</span><span class="s">&quot;toc&quot;</span> <span class="na">elementname=</span><span class="s">&quot;Inhaltsverzeichnis&quot;</span> <span class="na">auswahl=</span><span class="s">&quot;$Inhalt&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/Datensatz&gt;</span>
 
<span class="nt">&lt;Datensatz</span> <span class="na">element=</span><span class="s">&quot;url&quot;</span><span class="nt">&gt;</span>
  ...
<span class="nt">&lt;/Datensatz&gt;</span>
</code></pre></div>
<div style="clear:both; border-bottom: 1px solid #a0a0a0; width: 100%"></div>
<a href="../index-de.html">Startseite</a> | <a href="../commands-de/layout.html">Befehlsreferenz</a> | Andere Sprache: <a href="../description-en/directories.html">Englisch</a> 
</body>
</html>
