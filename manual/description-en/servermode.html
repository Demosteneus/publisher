<!DOCTYPE html>
<html>
<head>
    <title>Server-mode</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <link rel="alternate" type="application/atom+xml"  title="changelog speedata Publisher (en)"  href="../changes-en.xml" />
    <link rel="stylesheet" href="../assets/css/normal.css" type="text/css" />
    <link rel="stylesheet" href="../assets/css/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../assets/css/colorbox.css" type="text/css" />
    <script src="../assets/js/jquery.min.js" ></script>
    <script src="../assets/js/jquery.colorbox-min.js" ></script>
    <script>
      $(document).ready(function(){
         $(".figure").colorbox({ rel: 'group1', opacity:0.5 });
      });
    </script>
</head>
<body>
<div id="logo"><a href="../index.html"><img src="../assets/images/publisher_logo.png" alt="Start page"></a></div>
<div class="">
<h1>Server-mode</h1>

<p>When the speedata Publisher is started in the server-mode (<code>sp server</code>), it
expects HTTP-requests on port 5266 (configurable).</p>

<p>The server mode must be used in a restricted environment. The current API (v0)
exposes all PDF files and other private information to all users with access
to the server. Future versions of the API might handle authentication.</p>

<h2><code>/available</code></h2>

<p>Return HTTP-status 200 (OK).</p>

<h2><code>/v0/publish</code></h2>

<p>When called with a POST-request, the speedata Publisher expects  a JSON file in the follwing format:</p>

<pre><code>{&lt;filename&gt;:&lt;base64 encoded file contents&gt;,
 &lt;filename&gt;:&lt;base64 encoded file contents&gt;,
 ...
 }
</code></pre>

<p>for example:</p>

<pre><code>{&quot;layout.xml&quot;:&quot;PD94bWwgdmVyc2lv....&quot;,
 &quot;data.xml&quot;:&quot;PGRhdGE+CiAgICA8Y29udGVudHM+PCFbQ0RBVEFbPHV...&quot; }
</code></pre>

<p>These files are copied into an empty directory and after the request, the program <code>sp</code> is called without arguments. The result of the POST request is in the form:</p>

<pre><code>{&quot;id&quot;:&quot;752869708&quot;}
</code></pre>

<p>with an HTTP status code 201 (Created).</p>

<p>If the JSON file is defective, the HTTP status code is 400 (bad request) and the returned contents is a text string, such as</p>

<pre><code>illegal base64 data at input byte 0
</code></pre>

<h3>Parameters</h3>

<p>A parameter can be specified to set the result name of the PDF (without extension):</p>

<p><code>/v0/publish?jobname=myfile</code> sets the jobname to &quot;myfile&quot;, so <code>/v0/pdf/&lt;id&gt;</code> returns the data with the given filename (plus the <code>.pdf</code>) extension. This is done via the HTTP header <code>Content-Disposition</code>. If the parameter is not supplied, the <code>jobname</code> is taken from the file <code>publisher.cfg</code>. If the file is not supplied or if the parameter is not set in that file, the <code>jobname</code> is set to <code>publisher</code>.</p>

<p>You can also submit additional variables: <code>/v0/publish?vars=var1%3Dvalue1</code>. This is similar to the command line parameter <code>--var</code>.  The parameter is URL-encoded in the form <code>var1=value1,var2=value2,var3=value3...</code>.</p>

<h2><code>/v0/delete/&lt;id&gt;</code></h2>

<p>GET: Remove the directory for this ID. Returns 200 if the ID is valid, 404 if not.</p>

<h2><code>/v0/publish/&lt;id&gt;</code></h2>

<p>A GET request with an id from the aforementioned POST request returns a JSON file with the following contents:</p>

<pre><code>{&quot;status&quot;:&quot;ok&quot;,&quot;path&quot;:&quot;/path/to/publisher.pdf&quot;,&quot;blob&quot;:&quot;&lt;base64 encoded PDF file&gt;&quot;,
 finished:&quot;2015-03-03T13:12:55+01:00&quot;}
</code></pre>

<p>or, in case of an error, if the id is unknown:</p>

<pre><code>{&quot;status&quot;:&quot;error&quot;,&quot;path&quot;:&quot;&quot;,&quot;blob&quot;:&quot;id unknown&quot;}
</code></pre>

<p>If the PDF file is not finished yet:</p>

<pre><code>{&quot;status&quot;:&quot;error&quot;,&quot;path&quot;:&quot;&quot;,&quot;blob&quot;:&quot;in progress&quot;}
</code></pre>

<p>The directory of the publishing run will be deleted right after the request, unless the URL has the suffix <code>?delete=false</code>.</p>

<h2><code>/v0/pdf/&lt;id&gt;</code></h2>

<p>A GET request with an id from the aforementioned POST request. In case of success, the PDF file gets returned with a 200 OK status. The request waits for the PDF file to be ready. On error, the answer is an error code:</p>

<table>
<thead>
<tr>
<th>Status code</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>200 OK</td>
<td>PDF rendered OK</td>
</tr>

<tr>
<td>404 Not Found</td>
<td>Id is invalid</td>
</tr>

<tr>
<td>406  Not Acceptable</td>
<td>PDF has errors</td>
</tr>
</tbody>
</table>

<h2><code>/v0/data/&lt;id&gt;</code></h2>

<p>Return the data file that has been copied to the server before. The format can be set with the URL parameter <code>format</code>:</p>

<table>
<thead>
<tr>
<th>Format</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>json</code> or <code>JSON</code></td>
<td>Return a JSON-file such as <code>{&quot;contents&quot;:&quot;&lt;XML Text&gt;&quot;}</code></td>
</tr>

<tr>
<td><code>base64</code></td>
<td>The result is an XML file, that is encoded base64 (<code>PGRhdGE+CiAgICA8....hPgo=</code>)</td>
</tr>

<tr>
<td>(no format)</td>
<td>Returns the XML file (<code>&lt;data&gt;...&lt;/data&gt;</code>)</td>
</tr>
</tbody>
</table>

<p>Example: <code>http://127.0.0.1:5266/v0/layout/1347678770?format=base64</code></p>

<h2><code>/v0/layout/&lt;id&gt;</code></h2>

<p>Return the layout file that has been copied to the server before. The format can be set with the URL parameter <code>format</code>:</p>

<table>
<thead>
<tr>
<th>Format</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>json</code> or <code>JSON</code></td>
<td>Return a JSON-file such as <code>{&quot;contents&quot;:&quot;&lt;XML Text&gt;&quot;}</code></td>
</tr>

<tr>
<td><code>base64</code></td>
<td>The result is an XML file, that is encoded base64 (<code>PGRhdGE+CiAgICA8....hPgo=</code>)</td>
</tr>

<tr>
<td>(no format)</td>
<td>Returns the XML file (<code>&lt;Layout&gt;...&lt;/Layout&gt;</code>)</td>
</tr>
</tbody>
</table>

<p>Example: <code>http://127.0.0.1:5266/v0/layout/1347678770?format=base64</code></p>

<h2><code>/v0/statusfile/&lt;id&gt;</code></h2>

<p>Return the file <code>publisher.status</code> that has been created during the last run. The format can be set with the URL parameter <code>format</code>:</p>

<table>
<thead>
<tr>
<th>Format</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>json</code> or <code>JSON</code></td>
<td>Return a JSON-file such as <code>{&quot;contents&quot;:&quot;&lt;XML Text&gt;&quot;}</code></td>
</tr>

<tr>
<td><code>base64</code></td>
<td>The result is an XML file, that is encoded base64 (<code>PGRhdGE+CiAgICA8....hPgo=</code>)</td>
</tr>

<tr>
<td>(no format)</td>
<td>Returns the XML file (<code>&lt;Status&gt;...&lt;/Status&gt;</code>)</td>
</tr>
</tbody>
</table>

<p>Example: <code>http://127.0.0.1:5266/v0/statusfile/1347678770?format=base64</code></p>

<h2><code>/v0/status</code></h2>

<p>Return the status for all publishing runs, that were started with <code>/v0/publish</code>.</p>

<p>The returned JSON file has the following format:</p>

<pre><code>{
  &quot;1997009134&quot;: {
    &quot;errorstatus&quot;: &quot;ok&quot;,
    &quot;result&quot;: &quot;finished&quot;,
    &quot;message&quot;: &quot;no errors found&quot;,
    &quot;finished&quot;: &quot;2016-05-23T11:14:14+02:00&quot;
  },
  &quot;1997329145&quot;: {
    &quot;errorstatus&quot;: &quot;ok&quot;,
    &quot;result&quot;: &quot;finished&quot;,
    &quot;message&quot;: &quot;no errors found&quot;,
    &quot;finished&quot;: &quot;2016-05-23T11:14:14+02:00&quot;
  }
}
</code></pre>

<p>See <code>/v0/status/&lt;id&gt;</code> for the meaning of the fields.</p>

<h2><code>/v0/status/&lt;id&gt;</code></h2>

<p>Determines the current status of the publishing run, which was POSTed to <code>/v0/publish</code>.</p>

<p>The returned JSON has the following keys:</p>

<table>
<thead>
<tr>
<th>Key</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>errorstatus</code></td>
<td>Is the request valid? Possible answers are <code>error</code> and <code>ok</code>. If it is <code>error</code>, the value of the <code>message</code> contains the reason for the error, the value for the key <code>result</code> is without any meaning.</td>
</tr>

<tr>
<td><code>result</code></td>
<td>Contains <code>failed</code> if the PDF file is created but with errors. <code>not finished</code> if the PDF file is not finished, <code>ok</code> if everything went fine.</td>
</tr>

<tr>
<td><code>message</code></td>
<td>Contains an informal message, for example <code>no errors found</code> or <code>2 errors occurred during publishing run</code>.</td>
</tr>

<tr>
<td><code>finished</code></td>
<td>Time stamp when the PDF was finished written to. Format is RFC3339, for example <code>2015-12-25T12:03:04+01:00</code>.</td>
</tr>
</tbody>
</table>

<h2><code>/v0/format</code></h2>

<p>Generates hyphenation points for a text, that is given via POST-request. The text is encoded in XML and can contain mandatory line breaks (<code>&lt;br class=&quot;keep&quot; /&gt;</code>) or mandatory mid-word breaks (<code>&lt;shy class=&quot;keep&quot; /&gt;</code>).</p>

<p>The returned XML has the same format as the request.</p>

<p>The XML-structure of the request and answer must confirm to the following RelaxNG Compact schema:</p>

<pre><code>namespace a = &quot;http://relaxng.org/ns/compatibility/annotations/1.0&quot;
start =
  element root {
    element text {
      (attribute hyphenate-limit-before { xsd:unsignedInt },
       attribute hyphenate-limit-after { xsd:unsignedInt })?,
      mixed {
        element br {
          attribute class { &quot;keep&quot; | &quot;soft&quot; }?,
          empty
        }+,
        element shy {
          attribute class { &quot;keep&quot; | &quot;soft&quot; }?,
          empty
        }+
      }
    }+
  }
</code></pre>

</div>


<div style="clear:both; border-bottom: 1px solid #a0a0a0; width: 100%; margin-top: 30px;"></div>
Version: 3.1.19 | <a href="../index.html">Start page</a> | <a href="../commands-en/layout.html">Element reference</a> | Other language:  <a href="../description-de/servermode.html">German</a>

</body>
</html>